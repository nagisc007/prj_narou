# -*- coding: utf-8 -*-
"""Chapter 02: Another end world.
"""
import os
import sys
sys.path.append(os.path.join(os.path.dirname(__file__), '../..'))
sys.path.append('storybuilder')

from storybuilder.builder import world as wd
from src.anotherend import config as cnf
THM = cnf.THEMES


# scenes
def sc_intro(w: wd.World):
    ak, zer = w.akura, w.zer
    return w.scene("冒頭",
            w.tag.comment("実はループものになっていて日付は毎回巻き戻る"),
            ak.talk().t("くはっ"),
            ak.do("wake").d("思い切り息を吐き出して両手を突き出しながら上体を起こした"),
            ak.look("彼女の幻", w.i.minae_exist2.flag()).d("その視界に一瞬",
                "後ろで手を組んでちらりと$meの方を見る小柄な少女の姿が映った"),
            ak.think().d("という勘違いをしたのだと",
                "目の前で確認した暗黒の壁に苦笑する"),
            ak.look().d("どこまでも闇だった"),
            ak.think().d("光あれ",
                "とでも言って世界を明るくしたいところだったが",
                "そんな異能は$meには備わっていない。",
                "$meは自分がただのどうしようもないくらい無能な人間であることをよく知っているし",
                "何より誰からも必要とされない。", "そんな存在なのだ"),
            zer.talk().t("随分と自己評価が低いのだな"),
            ak.be(w.stage.blackzone, w.day.current),
            ak.think().d("それは自分の声ではなかった"),
            ak.ask().t("誰だ？"),
            ak.behav().d("振り返る"),
            ak.think().d("いや", "振り返ったつもりなのだが",
                "視界が全くないだけに果たして本当に自分の首が左肩の方に曲がったのかどうか",
                "いまいち自信が持てない"),
            ak.talk().t("どこにいやがる？",
                "そもそもここはどこだ？"),
            ak.think().d("暗闇と謎の人物の存在が", "$meを饒舌にさせた"),
            ak.ask().t("そうか。",
                "$meは人攫いにあったんだな？",
                "身代金なんてものはとても用意できないから",
                "腎臓か？", "肝臓か？", "それとも心臓か？",
                "目玉や皮膚なら多少くれてやってもいいが",
                "$meの馬鹿が移るからお勧めはしないぞ？"),
            ak.look("謎の影の人物").d("闇の中に",
                "別の闇が浮かび上がるのが分かった"),
            ak.think().d("闇の中で闇？"),
            ak.look().d("そんなはずはない。",
                "けれど確実にその闇の人形は$meの方に向き直り",
                "その手にした闇のナイフを心臓へと向けて投げた"),
            zer.talk("name").t("$n_akura……"),
            ak.ask().t("なぜ$meの名を！？"),
            ak.hear(w.zer, "謎の声"),
            ak.think().d("だが闇はそれに答えず",
                "小さな笑い声と共にこんなことを言った"),
            w.zer.talk("お主は再び違う世界で目覚めるだろう"),
            ak.think().d("そして$meは再び意識の淵へと沈んでいった"),
            )

def sc_onthestreet(w: wd.World):
    ak, zer, ringi = w.akura, w.zer, w.ringi
    return w.scene("街角で目覚めた",
            w.tag.comment("１章で持っていた林檎をここでも持っている。アイテムは継続、の証拠"),
            ak.feel().d("最初に感じたのは",
                "ギシギシと木の軋むのが動いて遠ざかっていく音だった"),
            ak.feel().d("続いて右の頬に断続的に当てられる", "小さな突起"),
            ak.be("wake", w.stage.town2).d("ゆっくりと目を開けると",
                "そこにはモヒカン頭が見えた"),
            ak.look(w.ringi),
            ringi.talk().t("何見てんだよ", "あんちゃん？"),
            ak.look().d("髭面の厳つい男の顔は",
                "$meの記憶に問いただしてみる限りでは",
                "つい数分前に目撃したのと同じ造形をしている。",
                "住宅に衝突した馬車を見て$meの無事に笑っていた男だ"),
            ak.ask().t("いや、その……またすみません"),
            ak.look().d("つい謝ってしまったが",
                "男は「ハァ？」と明らかに機嫌を損ねて見える"),
            ak.feel().d("それにまだ頬を突くのを止める気配がない。",
                "というかその細くてつるんとした指の先の爪はスカイブルーで",
                "首周りに筋肉を巻きつけているのかという男のそれにしては",
                "いさかかおかしい"),
            ak.talk().t("ん？"),
            ak.look().d("ようやく視界がモヒカン男以外にも焦点が合うようになり",
                "それがすぐ右手のところで膝小僧を出して屈み込んでいる少女のものだと判明した"),
            ak.know(w.ringi, "初対面"),
            zer.talk().t("おはよぉ", "$n_akura"),
            ak.think("疑問").d("大きな碧い瞳の娘は", "それが綺麗に潰れるくらいににっこりとして$meの名を呼んだ"),
            ak.ask().t("何故$meの名を知っている？"),
            ak.ask("亜人"),
            ak.think().d("だがその疑問に声を返したのは何故かモヒカン男の方だった"),
            ringi.talk("何言ってんだ？").d("おい嬢ちゃん。",
                "お前の兄貴大丈夫なのか？", "やっぱ医者にでも診せた方がいいんじゃねえか？"),
            zer.talk().t("大丈夫だよぉ。", "$akuraったらいつもこうなの"),
            ak.look().d("そう微笑をモヒカンに向けながら", "娘は$meの肩を叩く"),
            zer.talk().d("とにかく立ちなよぉ。",
                "いつまでも転んだままじゃみっともないよぉ", "$akura"),
            ak.reply().t("お、おぉ……そうだな"),
            ak.look().d("言われるがままに$meは手を突いて腕立て伏せの要領で上体を起こす。",
                "右手は何故か林檎を握っていて", "潰れるかと思ったが何とかそのまま無事に耐えてくれた。",
                "それから右膝を置いてそのまま立ち上がる素振りを見せながら",
                "その女とモヒカン男", "その周辺の様子をゆっくり視界に入れた"),
            ak.think("違う世界").d("先程の亜人と呼ばれていたおかしげな人型の姿は見えない。",
                "それどころか石畳の上を行き交う人は着ている服こそコスプレ感満載だが",
                "誰もが真っ当な人間だと思えた"),
            zer.ask().t("どうしたの？", "$akura"),
            ak.look("町を見て歩く").d("石や煉瓦で出来た建物や",
                "荷馬車が通りを抜けていく感じはついさっき目にした世界と酷似していた。",
                "だが何かが違う。", "空気か", "臭いか", "それともこのじっとりと肌にまとわりつく娘の視線だろうか"),
            ak.ask().t("ところで本当にお前は一体誰なんだ？"),
            ak.look().d("そう尋ねた$meをモヒカンも少女も同様に苦笑を浮かべて見ている"),
            zer.talk().t("今は頭打ってちょっと記憶が混乱しているだけだよぉ。",
                "ね？", "あっちで少しお休みしよぉ？"),
            ringi.ask().t("最近危ない奴の噂も聞くし",
                "何だったら嬢ちゃん", "$meの店訪ねてくれてもいいぜ"),
            zer.reply().t("うん分かった。", "ありがとねぇ"),
            ak.look().d("手を振る娘に右腕を挙げて応えつつ",
                    "モヒカンは歩いて行ってしまった"),
            ak.look().d("その少女を", "改めて$meはじっくりと見やる"),
            ak.look().d("小学生高学年", "あるいは小柄な中学生といったところか。",
                    "綺麗なスカイブルーに染められた髪の毛が後頭部で一つに括られ",
                    "腰の中程までのポニーテールを作っている"),
            ak.look().d("着ている服は水兵の方を思わせる白の制服っぽい上下で",
                    "スカート丈は膝上くらいだ。",
                    "ついさっきまでその奥の縞模様がチラリズムしていたが",
                    "立ち上がった今はむっちりとした脚がスカートから伸びている"),
            ak.look().d("ちなみに胸については意見しないでおこうと思う"),
            zer.ask().t("何か今", "とぉってもイラっとすること考えなかった？"),
            ak.reply().t("いや。",
                    "それより……どうして$meを知っているか",
                    "そろそろ教えてくれてもいいんじゃないかな"),
            ak.look().d("そう言うと彼女は鼻で笑い", "顎で橋の方を差した"),
            ak.go().d("そちらへと歩き出す"),
            ak.move().d("この場ではまずいということだろう。",
                    "仕方なく$meも後に続いた"),
            ak.look("人が集まっている"),
            zer.deal("助けを求める"),
            ak.meet(w.zer),
            zer.talk("名前を知ってる"),
            ak.ask("お前誰？"),
            )

def sc_anothertown(w: wd.World):
    ak, zer, minae = w.akura, w.zer, w.minae
    return w.scene("違う異世界の町",
            w.tag.comment("主人公説明と世界観説明"),
            ak.be(w.stage.town2),
            ak.come("河川敷").d("石造りの橋が架かるのを右手に見上げながら",
                "草の斜面に腰を下ろす"),
            ak.deal().d("空腹を感じたので林檎を齧ろうとしたのだが、"),
            ak.talk().t("痛っ……何だよこれ置物か？"),
            ak.think().d("歯が立つ気配がなく", "$meはそれを目の前の小川に向かって放る"),
            ak.hear().d("ちゃぽ", "と涼しげな音を立てたが",
                "浮かんでくることはなくどうやら沈んでしまったようだ"),
            zer.talk().t("どうして名前を知っているのかぁ",
                "ってことだけじゃないよね", "$akuraが知りたいのってぇ"),
            ak.look().d("化粧をしているようには見えないのにつるりとした肌は白く",
                "そのきゅっと上がった唇は赤い。",
                "その娘は$meの左側に座ると",
                "まくれ上がったスカートを伸ばしてからこちらを見た"),
            ak.ask("だから何者？").t("紹介した覚えがない奴が自分の名前を知っていたら要注意だって",
                "保育園で習ったろ？"),
            zer.reply().t("それは$akuraが自分で名乗ったことを忘れているだけだよぉ"),
            ak.think().d("どういうことだ？"),
            zer.talk().t("そもそもがさぁ",
                "$meと$akuraは契約という固い絆で結ばれた",
                "いわば許嫁みたいなものなんだよぉ？"),
            ak.ask().t("契約って言葉に悪意しか感じられない。",
                "それこそ$meが寝てる間に勝手に書類作って判押させたとかそういう類だろ"),
            ak.think().d("くだらない言い回しをしながらも",
                "その女の目線や表情", "口の動き", "身振りの仕草をよく観察していた。",
                "人の嘘は言葉ではなく動きに現れると", "かつて教わったからだ"),
            ak.think().d("教わった？", "誰に？"),
            zer.talk().t("悪意に捉えると何でも悪意に見えてくるよぉ？",
                "じゃあさぁ",
                "結婚だって契約だけど",
                "それも悪意？",
                "あぁ、そういや$akuraまだ結婚できる年齢じゃなかったか"),
            ak.look().d("彼女は小さく舌を出して",
                "まるでアイドルがするように拳を自分の頭の上に持っていってウインクをする。",
                "その仕草に苛立ちを覚えるよりも早く",
                "彼女が$meの年齢に言及したことが引っかかった"),
            zer.ask().t("どうして年齢まで知っているんだ", "顔してるぅ。",
                "そりゃあ運命共同体ですから",
                "何だって知ってるよぉ。",
                "$akuraが童貞だってことも"),
            ak.reply().t("ど、どど、童貞ちゃうわい！"),
            ak.think().d("思わずテンプレ台詞を口にしてしまったが",
                "果たして本当にそうだろうか。",
                "記憶が曖昧で", "自分の名前と十七歳という年齢以外",
                "よく思い出せない"),
            ak.ask().t("何でも知ってるって言うなら",
                "ここは一体何なんだ？",
                "少なくとも日本じゃない。",
                "$meを海外にでも売ったのか？"),
            ak.deal().d("その疑問を彼女は一笑に付した。",
                "いやそれは一笑なんてものではなく",
                "お腹を抱えて笑い出し",
                "そのまま寝そべって終いには手足をばたつかせてまで笑いを全身で表現した"),
            ak.talk().t("もう十分笑っただろ。",
                    "そもそも言葉が通じている時点で色々とおかしい。",
                    "壮大なドッキリか？",
                    "そこまでする価値がある人間じゃないぞ", "この$n_akuraは"),
            zer.talk().t("質問が多すぎるよぉ", "$akura。",
                    "先生に習わなかった？",
                    "一度に沢山質問するのはただのおバカちゃんだってぇ"),
            ak.look().d("女はまだ笑っていたが",
                    "既に表情は真顔に戻り",
                    "「ね？」と口の端を上げてその笑い声を収めた"),
            ak.talk().t("じゃあ"),
            ak.look().d("目の前を流れていく川が陽光に照らされ",
                    "穏やかに煌めいている。",
                    "車の騒音も",
                    "飛行機の高音も響かない。",
                    "時折駆け抜ける馬車の音と",
                    "あちこちで上がる往来の人々の笑い声が",
                    "ここに日常があるのだと$meに教えていた"),
            ak.ask().t("名前"),
            zer.reply().t("$n_akura？"),
            ak.ask().t("そうじゃなくてお前の……あんたのことだよ"),
            ak.deal().d("震えながら人差し指を向けるとようやく自分のことかと納得し",
                    "彼女はこう返した"),
            zer.reply().t("$n_zer。",
                    "たぶんどの世界でも本当の名前は発音できないから",
                    "頭文字を取ってそう呼ばせている。",
                    "それでも本名が知りたいのぉ？"),
            ak.think().d("まるで源氏名だった。",
                    "だが名乗ってくれた以上", "そこから先を聞き出すのは野暮というものだ"),
            ak.talk().t("オッケー分かった。",
                    "それじゃあ$zer",
                    "何でも知っているっていうのなら",
                    "ここがさっきの世界と違うのかどうか教えてくれないか？"),
            ak.look().d("その質問の意図が分からなかったのか",
                    "$zerは小首を傾げる"),
            ak.talk().t("いやだから",
                    "お前何でも知ってるんだろ？",
                    "今まで$meが何度も殺されたのも見てきたんだろ？",
                    "少なくともさっきの世界にはもっと人間じゃない人間が沢山歩いていたのに",
                    "ここじゃ普通の人ばかりだ。",
                    "場所が変わったのか世界が変わったのかは$meには分からないが……それとも全部夢だったってのか？"),
            zer.reply().t("$akuraが何を言ってるかさっぱりなんだけどぉ",
                    "一つ確かなことを教えてあげると",
                    "$meとの契約によって$i_transferになった", "てことかなぁ"),
            ak.ask().t("$i_transfer？"),
            ak.think().d("聞いたことのない言葉だが",
                    "音から判断するとどうも$meの大嫌いな”$i_transnovel”という言葉が過る"),
            ak.explain().d("$i_transnovelとは大きな括りではファンタジィ小説の一つなのだが",
                    "現実の世界でうだつが上がらない$meみたいな人間が",
                    "事故や自殺、病気などで死んでしまい",
                    "剣と魔法とモンスターがそこら中に溢れているような世界の住人に生まれ変わって",
                    "それこそ特別な力を得て大した苦労もなく自分を慕う沢山の異性に囲まれるようになり",
                    "第二の人生を謳歌する。",
                    "そういうくだらない小説やアニメのことだ"),
            ak.ask().t("じゃあここは異世界だってのか？"),
            zer.reply("あんたが雇った妖精"),
            zer.talk(ak, w.i.transfer, THM["transfer"]),
            zer.reply().t("その異世界って言葉はよく分からないけどぉ",
                    "$meが$akuraと最初に契約した時にいた場所とは全然違うねぇ。",
                    "それが異世界ってことぉ？"),
            ak.look().d("くるくると大きな瞳を周囲に向けながら$zerは苦笑する"),
            ak.think().d("とぼけているのか", "本当に知らないのか", "いまいち判断が付かない。",
                    "ただ今の発言から高校なのか自宅なのかは分からないが",
                    "少なくとも$meが暮らしていた世界でこの女と会い",
                    "その契約とやらを交わしたことだけは理解できた"),
            ak.ask().t("分からないならいい。",
                    "それよりその$i_transferってのは一体何なんだ？"),
            zer.reply().t("永遠の彷徨う魂を持つ者",
                    "って$meは聞いてる。",
                    "それ以上のことは知らないけどぉ",
                    "$akuraには心当たりがあるんじゃないかなぁ？"),
            ak.think().d("仮にそれが「転生」という言葉をそのまま差すなら",
                    "仏教などの輪廻転生のような概念と考えることができるかも知れない。",
                    "$meも詳しくは知らないが死んでもまた別の生き物になるだけで",
                    "魂は永遠にそれを繰り返す。",
                    "そこから脱出することを解脱と言い",
                    "その解脱こそが幸福だとか書いてあるのを読んだことを思い出す"),
            ak.ask().t("なぜ$meはそんな契約をお前としたんだ？"),
            ak.think().d("目の前の少女とはこれが初対面のように感じていたから尚のこと",
                    "契約したという自分のことを信じられなかったし",
                    "記憶の片鱗にも見出だせないでいた"),
            zer.reply().t("契約は不可抗力みたいなものでぇ",
                    "本当はただ呼び出されただけだよぉ。",
                    "だって$me",
                    "次元の妖精って云われる存在だからぁ"),
            ak.ask().t("妖精……なのか？"),
            ak.look().d("翼や触覚", "長い耳とか",
                    "オーラみたいなものすら見えない。",
                    "ちょっとくらい可愛い容姿をしているが",
                    "それくらいなら容易に人間の中にも探し出せるだろう"),
            ak.talk().d("分かった。",
                    "だからだ"),
            zer.ask().t("何よぉ？"),
            ak.talk().d("お前が妖精らしくないからだ。",
                    "超次元的存在ならそれらしい格好とか能力とかを見せてもらえないと",
                    "単なる詐欺師と変わりない"),
            ak.look().d("そこまで言い切る前に$zerの表情は顔中の皺を寄せ集めたみたいに歪み",
                    "$meを睨みつけた"),
            ak.talk().t("正論にぐうの音も出ないか。",
                    "やっぱり詐欺師の類なんだな？",
                    "おかしいと思ったよ。",
                    "ほんとはここだって何かでかいスタジオの中に作ったセットなんだろう？"),
            ak.think().d("言い過ぎただろうか"),
            ak.look().d("彼女は膝を抱えてその間に顔を突っ込み",
                    "黙り込んでしまう。",
                    "いや", "何かぼそぼそと声を漏らしている"),
            ak.ask().t("ん？", "何か言いたいことがあるのか？"),
            zer.talk().t("そんなだから学校中の人間から死ねって言われたんだよ"),
            ak.think().d("それは今まで彼女が上げていた舌足らずな声と全く違っていた。",
                    "地獄の穴へと吐き出される呪詛のような",
                    "どす黒い感情が乗った喉を震わす低音。",
                    "自分の耳を疑って聞き返した$meに",
                    "全く同じリズムと音程で一言一句違わぬように繰り返す"),
            ak.ask().t("どういうことだよ……"),
            ak.look().d("片目を大きくして", "$zerは嗤う"),
            ak.ask().t("お前何知ってんだよ？",
                    "$meが", "学校中の人間から？",
                    "何なんだよ……"),
            ak.feel().d("頭が酷く痛む。",
                    "それに何度も目の上の辺りが赤く閃く"),
            ak.hear().d("続いて誰とも知れぬ笑い声が四方八方から襲いかかってきて",
                    "$meは思わず叫び声を上げた"),
            zer.talk().t("もう大丈夫だよ"),
            ak.think().d("とても優しい声だ"),
            zer.talk().t("もう心配しなくていいから。",
                    "全部$meが守ってあげる。",
                    "$akuraは何も心配しなくてもいいからね"),
            ak.feel().d("左の目からぼとり", "と涙が落ちていった"),
            ak.think().d("自分に何があったのか思い出せない。",
                    "けれど体か或いは心か。",
                    "$meのどこか一部はそれをしっかりと覚えているのだ"),
            ak.remember().d("その声と", "言葉と",
                    "頬を包んだ冷たい彼女の掌を"),
            ak.ask().t("お前",
                    "見たのか？"),
            zer.ask().t("え？"),
            ak.ask().t("$meが$n_minaeに振られたところ",
                    "見たのかって聞いてるんだよ！"),
            ak.look().d("その小さな肩を掴んで詰め寄った$meを",
                    "$zerは驚きの表情で見たが",
                    "質問の意味が分かるとゆっくりと首を縦に振り",
                    "こう返した"),
            zer.reply().t("だからあんたは$meと契約したんだよ。",
                    "$meは$n_minaeに呼び出された次元の妖精だから"),
            ak.look().d("そう告げて",
                    "まるで本物の$n_minaeみたいに寂しげに$zerは笑った"),
            ak.know("自分の状況"),
            ak.ask("他にもいるのか？"),
            zer.reply("yes"),
            ak.hear(w.killer),
            ak.think("魔王じゃない？"),
            ak.think("どうするか"),
            ak.feel(w.i.hungry.flag()),
            )

def sc_fantasybar(w: wd.World):
    ak, zer, ringi = w.akura, w.zer, w.ringi
    return w.scene("異世界バー",
            ak.come(w.stage.bar2),
            ak.look(ringi),
            ak.ask(ringi, "仕事"),
            ak.know("ギルドの仕組み"),
            ak.know("働いて金を得ることが必要"),
            ringi.ask("働いたことないのか？"),
            ak.remember("何か"),
            ).omit()

def sc_fantasyguild(w: wd.World):
    ak, zer, recep = w.akura, w.zer, w.reception2
    return w.scene("異世界ギルド",
            ak.ask().t("それで",
                "とにかくこの世界のことはよく分からんが",
                "$meのサポートをしてくれると",
                "こういう訳なんだな？"),
            zer.reply().t("そうだよぉ"),
            ak.look().d("悪意がない笑みに見えたが",
                "そもそも何も知らないのにとりあえず助けてあげると口にするのは",
                "悪意そのものかも知れないと$meには思えた"),
            ak.move().d("大通りに戻って道なりに歩いていく。",
                "教わったところではどうやら町の中央部にギルドと呼ばれる職業案内所のようなものがあるらしい"),
            ak.talk().t("まるでゲームの世界だな"),
            zer.ask().t("ゲームって将棋のこと？"),
            ak.talk().t("現代人がゲームって言えばテレビゲームのことだよ。",
                "将棋みたいにしっかりルールのあってそれが不変なものならいいが",
                "最近のはパッチだアップデートだって",
                "何か穴が見つかれば塞げばいいと思っているのばかりだよ。",
                "そんな後出しジャンケンに気づくと",
                "やっているのが馬鹿らしくなってくる"),
            ak.remember().d("不意にコントローラを構えてテレビ画面に向かって何発も無駄弾を撃っている彼女が思い出された。",
                "そのセーラー服の後ろから$meが手を支えて", "こうやるんだ", "とばかりにゾンビの頭を撃ち抜いてやる"),
            zer.ask().t("どうかしたのぉ？"),
            ak.look().d("気づくと$zerが下から顔を覗き込んでいた"),
            ak.talk().t("あれがギルドじゃねえか？"),
            ak.look().d("$meは気づかれないようにと五十メートルくらい前方の大きな建物を差す。",
                "三階建てだろうか。",
                "ところどころ金色に見える素材の石を積み上げ",
                "一階部分はゆるりとアーチを描くように湾曲している。",
                "その上にニ、三階部分が段重ねになった弁当のように乗っていたが",
                "二階部分の窓から長い垂れ幕が落とされていて",
                "それを目にした$meは思わず絶句した"),
            ak.talk().t("暗殺者出現のため本日の業務は休止……だと"),
            ak.look().d("その”暗殺者”なる存在がどれほどの脅威なのか分からないが",
                "少なくともギルドの建物の扉は固く閉ざされているし",
                "ご丁寧にその扉の前にも『本日臨時休業』の札が掛けられていた"),
            zer.talk().t("暗殺者ってまた物騒だねぇ"),
            ak.talk().t("いやその考えはおかしい。",
                "暗殺っていうのはそもそも人知れず行うのが目的だし",
                "誰か特定の人物を狙って実行されるのが普通だ。",
                "だがあれじゃ不特定多数を狙っているような書き方だし",
                "何より暗殺者がいるって知られている時点で暗殺は失敗じゃないか？"),
            ak.think().d("それとも$meの知る暗殺者という言葉とは概念そのものが違うのだろうか"),
            ak.look().d("$zerを見たが$meの説明が理解できなかったのか小首を傾げて笑っている"),
            ak.think().d("とにかく無一文な上に",
                "ギルドなんてものがある世界だ。",
                "このままじゃ仕事をすることさえままならない可能性もある"),
            ak.deal().d("$meは思い切り木製のドアを叩きつけ",
                "中の人間を呼びつけた"),
            ak.talk().t("業務休止でも誰かいるだろ？",
                "何とか話だけでも聞いてくれないか？",
                "こっちはこの街に来たばかりで文無しなんだよ"),
            ak.deal().d("ドンドンドン",
                    "と鳴らし続ける。",
                    "その音の一定のリズムに",
                    "次第に胸が気持ち悪くなり",
                    "$meは吐いた"),
            recep.talk().t("なんで……？"),
            ak.look().d("薄っすらとドアを開けた眼鏡の女性が",
                    "思い切り怪訝な顔をして蹲る$meに視線を投げつけた"),
            )

def sc_intheguild(w: wd.World):
    ak, zer, recep = w.akura, w.zer, w.reception2
    return w.scene("ギルドにて",
            ak.come(w.stage.guild2).d("建物の中は大きなホールになっていた。",
                "見上げた天井は五メートルほどの高さがあったが柱が部屋の隅にしか見つからない。",
                "現代建築ならまだしも", "崩れやしないのだろうかと不安になる"),
            recep.talk().t("ゲロで脅してまで中に入ろうとする方", "あなたが初めてですよ"),
            ak.look().d("赤縁の眼鏡と腰まで落とした真っ直ぐな緑の髪が目に付くその女性が",
                "ギルドの受付係らしかった。",
                "きっちりした襟付きの濃紺の制服に青と白のストライプのタイがよく似合っている。",
                "スカート丈は膝下まであったが", "そこから伸びた脚が黒いストッキングで覆われていて",
                "底の浅いヒールを履いているのがよく見えたが",
                "ストッキングなんて代物を編めるだけの技術力があるのかと",
                "$meの感心は専らそちらに向かっていた"),
            recep.ask().t("これは高級品なんですからね。",
                "時々破りたいって方がいらっしゃるようですが", "とても下々の者の稼ぎじゃ支払えない程の物なんですよ"),
            ak.talk().t("$meにそんな趣味はない。",
                "それよりここじゃ何か職業に就かなきゃ仕事もできないって聞いたんだが"),
            ak.look().d("彼女は$meを値踏みするように下から上までを一通り見やると、"),
            recep.reply().t("ええ", "そうですが"),
            ak.hear().d("とだけ返事をして", "小さな溜息を零した"),
            ak.ask().t("何か不満なのか？"),
            recep.talk().t("不満ではなくて",
                "その、失礼ですが",
                "この町の方ではありませんね？"),
            ak.look().d("ボーダーのシャツに膝が薄くなったジーンズという格好がまずかったのだろうか。",
                "彼女は明らかに不信感を抱いたようで", "自分の胸を守るように腕組みをした"),
            ak.talk().t("この町の人間じゃないと職には就けないのか？",
                "普通ゲームじゃそんなこと問われないぞ"),
            recep.ask().t("げえむ？"),
            ak.talk().t("あ、いや",
                "$meの世界じゃもっと親切にしてくれるって話さ"),
            ak.look().d("慌てて言い訳をしたが", "$zerは小さな体を震わせて笑い声を堪えている"),
            ak.talk().t("その、とにかくだな",
                "仕事がないと飯が食えない。",
                "飯が食えないと$meは飢え死にする。",
                "ここまでは分かるな？"),
            recep.talk().t("うちでは慈善事業はやっておりません。",
                "お腹が空いているなら教会などで恵んでもらって下さい"),
            ak.look().d("可哀想なものを見る目だった"),
            ak.think().d("少し斜に構え",
                "できれば関わりたくないという意志がその眉と目元に現れている。",
                "$meが何度も体験した視線だ"),
            ak.think().d("何度も……どこで？"),
            recep.talk().t("あなたの住む町のことはよく知りませんけど",
                "少なくともここでは身元の保証がない人間に好き勝手に職を与えるということはしておりません。",
                "それとも何か身分や身元を保証するものをお持ちでしょうか？"),
            ak.think().d("身分証。",
                "そう言われて$meは慌ててポケットを弄ったが何も手に触れない"),
            ak.ask().t("おい"),
            ak.look().d("$zerに視線を送るが", "彼女は苦笑して首を横に振っただけだ"),
            recep.talk().t("つまりあなた方は現状",
                "単なる不審者であり",
                "ということは暗殺者である可能性も持っていらっしゃるということです。",
                "おわかりいただけたならご退場願えますか？"),
            ak.look().d("そう言いながら彼女は机の奥から赤い石の付いた杖を取り出すと",
                    "その先端をこちらへと向けた"),
            ak.ask().t("あれは何だ？"),
            zer.reply().t("何らかの攻撃をする武器じゃないかなぁ。",
                    "とぉっても強いエネルギィを感じちゃう"),
            ak.think().d("聞くまでもなかったと思い",
                    "$meは慌てて両手を前に出す"),
            ak.talk().t("いきなり押しかけて職をくれってのは悪かったよ。",
                    "ただ$meはその暗殺者でも何でもないし",
                    "あんたに危害は加えない。",
                    "だからその物騒なもん仕舞ってくれると助かるんだが"),
            recep.talk().t("では暗殺者ではないという証明ができる？",
                    "できないでしょう？",
                    "そんな甘言で懐柔しようというのは",
                    "逆に何か後ろ暗いところがある証拠ではないの？"),
            ak.talk().t("いや言っとくが$meはな",
                    "自分の名前以外ほとんど何も覚えてないんだよ。",
                    "いきなりこの町に投げ出されて",
                    "とにかく飯食うにも仕事しなきゃならないってんでここに来たんだ。",
                    "それがどうして暗殺者扱いされなきゃならねえんだよ。",
                    "そうだろ？"),
            ak.think().d("何の能力もない。",
                    "見た目も性格も良くない。",
                    "そんな$meが今ここで出来ることと言ったら",
                    "とにかく正直に状況を話して相手の理解を求めることだろう。",
                    "あわよくばお情けで職をくれるかも知れない"),
            ak.look().d("だが彼女は杖を降ろさないままじっと$meと$zerを見やり",
                    "顎で出ていくようにと指図した"),
            ak.look().d("だがそれでも動こうとしないと見ると",
                    "何やら口元をもぞもぞと動かして聞き取り不可能な言葉の羅列をすると、"),
            recep.talk().t("ゲラウト！"),
            ak.deal().d("そう大声で怒鳴りつけて杖を前へと押しやった"),
            ak.deal().d("赤い石の周囲が歪む"),
            ak.talk().t("やばい……"),
            ak.move().d("$meは慌てて背を向けて走り出したが、"),
            ak.look().d("その頭上を炎の絨毯が圧倒的な速度で駆け抜けていき",
                    "扉を跳ね飛ばしてそこに穴を開けた"),
            ak.ask().t("こ、殺すつもりかよ！"),
            ak.look().d("けれど$meの言葉を聞くつもりはないらしく",
                    "次なる詠唱を始めている"),
            ak.talk().t("とにかく逃げるぞ！"),
            ak.look().d("そう$zerに言ったつもりだったが、"),
            zer.ask().t("何してるのよぉ"),
            ak.look().d("彼女は既に建物の外に出てしまっていて", "まだ危険領域に留まっている$meに大声で呆れていた"),
            recep.deal("受付"),
            ak.deal("登録"),
            recep.explain("仕組み"),
            ak.deal("旅芸人"),
            zer.deal("巫女"),
            ak.ask("仕事は？"),
            recep.explain("クエスト説明"),
            ak.look("掲示板"),
            ak.think("無理"),
            ak.look("普通の仕事"),
            )

def sc_mywork(w: wd.World):
    ak, zer = w.akura, w.zer
    return w.scene("そうだ仕事をしよう",
            ak.deal("土木作業"),
            ak.go("現場"),
            ak.deal("壁の補修"),
            ak.go(w.stage.eating2),
            ak.deal("一番安い食事"),
            ak.go(w.stage.stable2),
            ak.deal("並んで睡眠"),
            ak.think("繰り返す日々"),
            ak.think("これでいいのか？"),
            ak.remember(w.minae),
            ).omit()

def sc_quest(w: wd.World):
    ak, zer, recep = w.akura, w.zer, w.reception2
    return w.scene("クエスト",
            ak.come(w.stage.guild2),
            recep.ask("何です？"),
            ak.look("誰もやってない"),
            ak.deal("冒険クエスト受注"),
            recep.talk(w.i.killer),
            ak.know(w.i.killer),
            ak.ask(w.minae),
            recep.reply("人探しなら依頼して"),
            ).omit()

def sc_shopping(w: wd.World):
    ak, zer, ringi = w.akura, w.zer, w.ringi
    return w.scene("装備調達",
            ak.come(w.stage.weaponshop2),
            ringi.talk("武器トーク"),
            ak.deal("有り金なくなる"),
            zer.talk("稼げばいい"),
            ak.think("その通りだ"),
            ).omit()

def sc_gotoout(w: wd.World):
    ak, zer, gatekp = w.akura, w.zer, w.gatekeeper2
    return w.scene("いざフィールドへ",
            ak.come(w.stage.gate2),
            ak.talk(gatekp),
            gatekp.talk(w.i.killer),
            ak.talk("大丈夫"),
            ).omit()

def sc_firstbattle(w: wd.World):
    ak, zer = w.akura, w.zer
    return w.scene("最初の戦闘",
            ak.go(w.stage.field2),
            ak.look("巨大蛇"),
            ak.deal("戦闘"),
            ).omit()

def sc_blackstreet(w: wd.World):
    ak, zer = w.akura, w.zer
    return w.scene("路地裏の殺人",
            ak.move(w.stage.street2).d("ギルドから逃げ出して五分くらいはずっと走り続けただろうか"),
            ak.talk().t("さ、流石にもういいだろ……"),
            ak.feel().d("心臓が破裂しそうになっていたが",
                "何故だろう。",
                "その息苦しさが意外と心地よく感じた"),
            ak.ask().t("何だよ$zer"),
            ak.look().d("息一つ切らさずに黙ってついてきていた彼女は肩を大きく揺らす$meを見やって口の端を上げる"),
            zer.reply().t("うぅん。",
                "何でもないよぉ。",
                "ただ",
                "死にたくないんだなぁって思ってぇ"),
            ak.think().d("相変わらず何考えているのかよく分からない"),
            ak.talk().d("けどギルドが駄目になったらどうやって稼げばいいんだ？",
                "ゲームみたいに適当に家に入ってタンス漁ればいいのか？"),
            zer.ask().t("それ泥棒って呼ぶんじゃない？"),
            ak.think().d("違いない。",
                "だがそこに罰する法律でもなければ",
                "生きる為の一つの術として考えなければならないだろう"),
            ak.feel().d("散々走った所為か",
                "酷い空腹だった"),
            ak.ask().t("なあ$zer。",
                "その次元の妖精ってのはこう",
                "目の前にパンとか水とか出せないのかよ？"),
            zer.reply().t("何それ？",
                "手品？"),
            ak.talk().t("手品なら現物をもともと持ってることになるだろ？",
                "そうじゃなくて何もないところに出現させるというか……"),
            ak.look(w.minae, w.i.minae_exist2.deflag()).d("彼女に説明しようと目の前に両手を出して",
                "身振りをつけようとした時だった。",
                "$meの視界の端に",
                "肩までの黒髪をなびかせてあの規則正しい歩幅で歩いていく",
                "よく知る女性の姿が横切ったのに気づく"),
            zer.ask().t("$akura？"),
            ak.talk().t("$fn_minae……"),
            ak.go("追いかける").d("$meの足はそう呟くより早く",
                "地面を蹴りつけていた"),
            ak.think().d("狭い路地に入っていく彼女を見つけ",
                "慌てて追う"),
            ak.think(w.i.needtosay_word.flag()).d("もし自分だけでなく彼女もまたその$i_transferというものになっているとしたら",
                "もう一度だけでいい",
                "話を聞いて欲しい。",
                "そうだ。",
                "$meは彼女に伝えなきゃならないことがある。",
                "それは……"),
            ak.talk().t("何だ……$meは一体何を言わなきゃならないんだ？"),
            ak.think().d("とても大切なことだという思いだけが",
                "記憶の奥深くに残っていた。",
                "それは好きとか愛しているとか",
                "そんな甘酸っぱい感情じゃない。",
                "もっと大切な",
                "それこそ生死に関わるような重要な何かだったはずだ"),
            ak.move().d("いくつ路地を曲がっただろう。",
                    "いつの間にか$zerと離れていた"),
            ak.look().d("おまけに肝心の彼女も見失い",
                    "四方八方似たような建物に囲まれた交差点の真ん中で",
                    "どこに行けばいいのかすら見当が付けられない"),
            ak.think().d("いや。",
                    "何かおかしい"),
            ak.feel().d("冷たい風を感じたが",
                    "道端の木切れは微動だにしていない"),
            ak.look().d("空を見上げると",
                    "一羽の黒鳥が翼を広げたまま静止していた"),
            ak.ask().t("何だ……"),
            ak.feel().d("首筋が寒くなる"),
            ak.talk().t("誰かいるのか？"),
            ak.hear().d("何かの声を聞いた気がした"),
            ak.look().d("けれど見回しても何者も確認できない"),
            ak.think().d("いや", "そこに”ヤツ”がいた"),
            ak.look().d("全身真っ黒なマントに身を包み",
                    "音もなく向かってくる"),
            ak.look().d("そのマントから一本の腕とそれが握る黒光りする湾曲した刃が見えたが",
                    "息を呑むことすらできない"),
            ak.feel().d("動けない",
                    "というレベルではなかった。",
                    "ひょっとすると",
                    "一秒と一秒の間の出来事だったのだろうか"),
            ak.talk().t("あ"),
            ak.look().d("$meが見ている前で",
                    "$meの胴体が腹の辺りから真っ二つになり",
                    "視界が二回転ほどしてから",
                    "地面でいっぱいになった"),
            ak.think().d("嘘……だろ"),
            ak.think().d("どこか遠くで誰かが嗤うのを聞いた気がしたが",
                    "意識はその主を突き止めるなんて余裕もないまま",
                    "ゼロになった"),
            ak.look(zer, "逸れる"),
            ak.feel(w.i.hungry.deflag()),
            ak.deal("殺された"),
            )

# episodes
def ep_avant(w: wd.World):
    return (w.chaptertitle("素晴らしい異世界"),
            sc_intro(w),
            sc_onthestreet(w),
            )

def ep_guild(w: wd.World):
    return (w.chaptertitle("ギルドにて"),
            sc_anothertown(w),
            sc_fantasybar(w),
            sc_fantasyguild(w),
            )

def ep_cheatworld(w: wd.World):
    return (w.chaptertitle("裏切る世界"),
            sc_intheguild(w),
            sc_mywork(w),
            sc_quest(w),
            sc_shopping(w),
            sc_gotoout(w),
            sc_firstbattle(w),
            sc_blackstreet(w),
            )


# main
def story(w: wd.World):
    return (w.maintitle("この素晴らしい２番煎じの異世界に祝福を"),
            ep_avant(w),
            ep_guild(w),
            ep_cheatworld(w),
            )


def main(): # pragma: no cover
    from src.anotherend.story import world
    w = world()
    return w.build(story(w))


if __name__ == '__main__':
    import sys
    sys.exit(main())

